# Ninja DNS - Браузерные тесты

Автоматические тесты для проверки функциональности DNS-проверки в браузере.

## Что тестируется

1. **Загрузка страницы** - проверка что страница DNS проверки корректно загружается
2. **DNS с Ninja DNS** - проверка поведения когда клиент использует наш DNS сервер  
3. **DNS с публичным DNS** - проверка что показывается "не подключен" при использовании 8.8.8.8
4. **Повторная проверка** - тестирование кнопки "Проверить заново"
5. **Отзывчивость** - проверка интерфейса на разных разрешениях экрана

## Логика тестирования

Тесты запускаются в реальном браузере (Chromium) и проверяют JavaScript логику клиентской стороны:

- Тест временно меняет DNS сервер на машине (через `/etc/resolv.conf`)
- Открывает страницу `https://dns.uzicus.ru/` в браузере  
- Ждет выполнения автоматической DNS проверки
- Проверяет отображаемый результат в интерфейсе

## Как запустить

### Быстрый запуск
```bash
cd /root/baltic-dns
./tests/run_tests.sh
```

### Ручной запуск
```bash
cd /root/baltic-dns/tests
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
playwright install chromium
python browser_dns_test.py
```

## Требования

- Python 3.8+
- Права root (для изменения `/etc/resolv.conf`)
- Интернет соединение
- Работающий Ninja DNS сервер на `185.237.95.211`

## Ожидаемые результаты

- **Тест 1**: ✅ Страница загружается
- **Тест 2**: ✅ или ⚠️ (зависит от DNS настроек) 
- **Тест 3**: ✅ Показывает "не подключен" с публичным DNS
- **Тест 4**: ✅ Повторная проверка работает
- **Тест 5**: ✅ Интерфейс отзывчивый

## Отладка

Если тесты падают:

1. Проверьте что `test.dns.uzicus.ru` резолвится:
   ```bash
   nslookup test.dns.uzicus.ru 185.237.95.211
   ```

2. Проверьте что сервисы запущены:
   ```bash
   docker compose ps
   ```

3. Посмотрите логи:
   ```bash
   docker compose logs admin
   docker compose logs traefik
   ```

4. Проверьте статический файл доступен:
   ```bash
   curl https://test.dns.uzicus.ru/static/test.json
   ```