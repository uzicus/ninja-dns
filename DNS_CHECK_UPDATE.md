# Обновление DNS проверки через загрузку картинки

## Внесенные изменения

### 1. Создана картинка pixel.png
- Расположение: `/root/baltic-dns/admin/static/pixel.png`
- Размер: 1x1 пиксель, прозрачная PNG
- Доступна через статические файлы FastAPI

### 2. Добавлен маршрут в FastAPI
- Файл: `/root/baltic-dns/admin/app/main.py`
- Маршрут: `@app.get("/pixel.png")`
- Логика: отдает картинку только для домена `test.dns.uzicus.ru`
- Для других доменов возвращает 404

### 3. Обновлена клиентская проверка DNS
- Файл: `/root/baltic-dns/admin/templates/dns_check.html`
- Изменен метод проверки с HTTPS fetch на загрузку картинки через `<img>`
- Использует события `onload` и `onerror` для определения статуса DNS
- URL проверки: `http://test.dns.uzicus.ru/pixel.png`

### 4. Конфигурация
- Домен `test.dns.uzicus.ru` уже настроен в SmartDNS
- Резолвится в IP: 185.237.95.211
- Traefik правильно маршрутизирует запросы к админке

## Преимущества нового подхода

1. **Обход Mixed Content** - картинки можно загружать по HTTP с HTTPS страниц
2. **Простота** - не требует сложной логики, работает во всех браузерах
3. **Надежность** - четкое определение статуса через события загрузки
4. **Производительность** - минимальный размер картинки (67 байт)

## Тестирование

1. Откройте https://dns.uzicus.ru/ в браузере
2. DNS проверка запустится автоматически
3. Если DNS настроен правильно - увидите зеленое сообщение
4. Если DNS не настроен - увидите красное сообщение с инструкциями

### Локальное тестирование
```bash
# Проверка через curl
curl -H "Host: test.dns.uzicus.ru" http://185.237.95.211/pixel.png

# Проверка через браузер
# Откройте файл /root/baltic-dns/test-dns-check.html
```

## Важно помнить

⚠️ **При изменении Python кода необходимо пересобирать контейнер admin:**
```bash
docker compose build admin && docker compose up -d admin
```